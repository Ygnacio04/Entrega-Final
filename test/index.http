@baseUrl = http://localhost:3000/api
@token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2ODIyMmE5NmJlNjlmNTMyZjEwMTE2YWQiLCJyb2xlIjoidXNlciIsImVtYWlsIjoiaTgxMGFnMDRAZ21haWwuY29tIiwiaWF0IjoxNzQ3MDY5NTkwLCJleHAiOjE3NDcxNTU5OTB9.lmy_7vDjsEgA7yo_n0pmXy8h5pUdRa0pPtsXMiSZ0j8
@clientId = 
@projectId = 
@deliveryNoteId =
@invitationId =

###############################################
#            AUTENTICACIÓN DE USUARIOS       #
###############################################

### 1. Registro de usuario (ejecutar primero para obtener token)
# @name register
POST {{baseUrl}}/user/register
Content-Type: application/json

{
  "firstName": "Ignacio",
  "lastName": "Arregui",
  "email": "i810ag04@gmail.com",
  "password": "Password123"
}

### Capturar automáticamente el token después del registro
@authToken = {{register.response.body.token}}

### 2. Verificación de email (tras recibir código)
POST {{baseUrl}}/user/verify-email
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "email": "i810ag04@gmail.com",
  "verificationCode": "123456"
}

### 3. Login de usuario
# @name login
POST {{baseUrl}}/user/login
Content-Type: application/json

{
  "email": "i810ag04@gmail.com",
  "password": "Password123"
}

### Capturar automáticamente el token después del login
@authToken = {{login.response.body.token}}

### 4. Obtener datos del usuario actual
GET {{baseUrl}}/user/me
Authorization: Bearer {{authToken}}

### 5. Actualizar datos de usuario (onboarding)
PUT {{baseUrl}}/user/onboarding
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "firstName": "Juan Carlos",
  "lastName": "Pérez García",
  "company": {
    "name": "Mi Empresa SL",
    "cif": "B12345678",
    "address": {
      "street": "Calle Principal",
      "number": 123,
      "postal": 28001,
      "city": "Madrid"
    }
  }
}

### 6. Solicitar recuperación de contraseña
POST {{baseUrl}}/user/forgot-password
Content-Type: application/json

{
  "email": "i810ag04@gmail.com"
}

### 7. Restablecer contraseña
POST {{baseUrl}}/user/reset-password
Content-Type: application/json

{
  "token": "123456",
  "newPassword": "NewPassword456"
}

### 8. Subir logo de perfil
PATCH {{baseUrl}}/user/logo
Authorization: Bearer {{authToken}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="image"; filename="logo.png"
Content-Type: image/png

< ./logo.png
------WebKitFormBoundary7MA4YWxkTrZu0gW--

###############################################
#             GESTIÓN DE INVITACIONES        #
###############################################

### 9. Registro de un segundo usuario para invitaciones
# @name registerSecond
POST {{baseUrl}}/user/register
Content-Type: application/json

{
  "firstName": "Ana",
  "lastName": "García",
  "email": "ana.garcia@example.com",
  "password": "Password123"
}

### 10. Enviar invitación a un usuario
# @name sendInvitation
POST {{baseUrl}}/user/invitations/send
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "email": "ana.garcia@example.com",
  "role": "user"
}

### Capturar el ID de la invitación de la respuesta
@invitationId = {{sendInvitation.response.body.invitation._id}}

### 11. Obtener invitaciones recibidas
GET {{baseUrl}}/user/invitations/received
Authorization: Bearer {{authToken}}

### 12. Obtener invitaciones enviadas
GET {{baseUrl}}/user/invitations/sent
Authorization: Bearer {{authToken}}

### 13. Aceptar una invitación
PUT {{baseUrl}}/user/invitations/accept/{{invitationId}}
Authorization: Bearer {{authToken}}

### 14. Rechazar una invitación
PUT {{baseUrl}}/user/invitations/reject/{{invitationId}}
Authorization: Bearer {{authToken}}

### 15. Cancelar una invitación enviada
DELETE {{baseUrl}}/user/invitations/cancel/{{invitationId}}
Authorization: Bearer {{authToken}}

###############################################
#             GESTIÓN DE CLIENTES            #
###############################################

### 16. Crear un nuevo cliente
# @name createClient
POST {{baseUrl}}/client
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "name": "Empresa Cliente S.L.",
  "nif": "B87654321",
  "address": {
    "street": "Calle Comercial",
    "number": 42,
    "postal": 28002,
    "city": "Madrid"
  },
  "email": "contacto@empresa-cliente.com",
  "phone": "912345678"
}

### Capturar el ID del cliente creado
@clientId = {{createClient.response.body.client._id}}

### 17. Obtener todos los clientes
GET {{baseUrl}}/client
Authorization: Bearer {{authToken}}

### 18. Obtener un cliente específico
GET {{baseUrl}}/client/{{clientId}}
Authorization: Bearer {{authToken}}

### 19. Actualizar un cliente
PUT {{baseUrl}}/client/{{clientId}}
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "name": "Empresa Cliente Actualizada S.L.",
  "email": "nuevo.contacto@empresa-cliente.com",
  "phone": "913456789"
}

### 20. Actualización parcial de cliente
PATCH {{baseUrl}}/client/{{clientId}}
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "phone": "914567890"
}

### 21. Archivar un cliente (soft delete)
DELETE {{baseUrl}}/client/{{clientId}}
Authorization: Bearer {{authToken}}

### 22. Obtener clientes archivados
GET {{baseUrl}}/client/archived
Authorization: Bearer {{authToken}}

### 23. Restaurar un cliente archivado
PUT {{baseUrl}}/client/restore/{{clientId}}
Authorization: Bearer {{authToken}}

### 24. Eliminar permanentemente un cliente (hard delete)
# Advertencia: esto eliminará el cliente permanentemente
# DELETE {{baseUrl}}/client/{{clientId}}?hard=true
# Authorization: Bearer {{authToken}}

###############################################
#             GESTIÓN DE PROYECTOS           #
###############################################

### 25. Crear un nuevo proyecto
# @name createProject
POST {{baseUrl}}/project
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "name": "Desarrollo Web Corporativo",
  "description": "Creación de sitio web responsive con área de clientes",
  "client": "{{clientId}}",
  "startDate": "2023-05-01T00:00:00.000Z",
  "status": "in-progress"
}

### Capturar el ID del proyecto creado
@projectId = {{createProject.response.body.project._id}}

### 26. Obtener todos los proyectos
GET {{baseUrl}}/project
Authorization: Bearer {{authToken}}

### 27. Filtrar proyectos por cliente
GET {{baseUrl}}/project?clientId={{clientId}}
Authorization: Bearer {{authToken}}

### 28. Obtener un proyecto específico
GET {{baseUrl}}/project/{{projectId}}
Authorization: Bearer {{authToken}}

### 29. Actualizar un proyecto
PUT {{baseUrl}}/project/{{projectId}}
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "name": "Desarrollo Web Corporativo 2.0",
  "description": "Creación de sitio web responsive con área de clientes y blog",
  "status": "completed",
  "endDate": "2023-07-15T00:00:00.000Z",
  "client": "{{clientId}}"
}

### 30. Archivar un proyecto (soft delete)
DELETE {{baseUrl}}/project/{{projectId}}
Authorization: Bearer {{authToken}}

### 31. Obtener proyectos archivados
GET {{baseUrl}}/project/archived
Authorization: Bearer {{authToken}}

### 32. Restaurar un proyecto archivado
PUT {{baseUrl}}/project/restore/{{projectId}}
Authorization: Bearer {{authToken}}

### 33. Eliminar permanentemente un proyecto (hard delete)
# Advertencia: esto eliminará el proyecto permanentemente
#DELETE {{baseUrl}}/project/{{projectId}}?hard=true
#Authorization: Bearer {{authToken}}

###############################################
#             GESTIÓN DE ALBARANES           #
###############################################

### 34. Crear un nuevo albarán
# @name createDeliveryNote
POST {{baseUrl}}/deliverynote
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "project": "{{projectId}}",
  "date": "2023-06-15T00:00:00.000Z",
  "workedHours": [
    {
      "person": "Juan Pérez",
      "hours": 8,
      "date": "2023-06-15T09:00:00.000Z",
      "description": "Desarrollo frontend",
      "hourlyRate": 25
    },
    {
      "person": "Ana García",
      "hours": 6,
      "date": "2023-06-15T10:00:00.000Z",
      "description": "Diseño UX/UI",
      "hourlyRate": 30
    }
  ],
  "materials": [
    {
      "name": "Licencia de software",
      "quantity": 1,
      "price": 150,
      "description": "Licencia anual"
    },
    {
      "name": "Dominio web",
      "quantity": 1,
      "price": 15,
      "description": "Renovación anual"
    }
  ],
  "observations": "Entrega parcial del proyecto, pendiente de aprobación"
}

### Capturar el ID del albarán creado
@deliveryNoteId = {{createDeliveryNote.response.body.deliveryNote._id}}

### 35. Obtener todos los albaranes
GET {{baseUrl}}/deliverynote
Authorization: Bearer {{authToken}}

### 36. Filtrar albaranes por proyecto
GET {{baseUrl}}/deliverynote?projectId={{projectId}}
Authorization: Bearer {{authToken}}

### 37. Filtrar albaranes por cliente
GET {{baseUrl}}/deliverynote?clientId={{clientId}}
Authorization: Bearer {{authToken}}

### 38. Filtrar albaranes por estado
GET {{baseUrl}}/deliverynote?status=pending
Authorization: Bearer {{authToken}}

### 39. Obtener un albarán específico
GET {{baseUrl}}/deliverynote/{{deliveryNoteId}}
Authorization: Bearer {{authToken}}

### 40. Actualizar un albarán
PUT {{baseUrl}}/deliverynote/{{deliveryNoteId}}
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "project": "{{projectId}}",
  "observations": "Entrega parcial del proyecto, aprobada por el cliente",
  "status": "pending",
  "workedHours": [
    {
      "person": "Juan Pérez",
      "hours": 10,
      "date": "2023-06-15T09:00:00.000Z",
      "description": "Desarrollo frontend y backend",
      "hourlyRate": 25
    }
  ]
}

### 41. Obtener PDF de un albarán
GET {{baseUrl}}/deliverynote/pdf/{{deliveryNoteId}}
Authorization: Bearer {{authToken}}

### 42. Firmar un albarán
POST {{baseUrl}}/deliverynote/sign/{{deliveryNoteId}}
Authorization: Bearer {{authToken}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="signature"; filename="firma.png"
Content-Type: image/png

< ./firma.png
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="signer"

Antonio Cliente
------WebKitFormBoundary7MA4YWxkTrZu0gW--

### 43. Archivar un albarán (soft delete)
DELETE {{baseUrl}}/deliverynote/{{deliveryNoteId}}
Authorization: Bearer {{authToken}}

### 44. Eliminar permanentemente un albarán (hard delete)
# Advertencia: esto eliminará el albarán permanentemente
# DELETE {{baseUrl}}/deliverynote/{{deliveryNoteId}}?hard=true
# Authorization: Bearer {{authToken}}

###############################################
#             OTROS ENDPOINTS                #
###############################################

### 45. Documentación Swagger
GET {{baseUrl}}-docs

### 46. Estado de la API
GET {{baseUrl}}/

### 47. Test de error para Slack
GET {{baseUrl}}/test-slack-error
Authorization: Bearer {{authToken}}

###############################################
#             GESTIÓN DE CUENTA USUARIO      #
###############################################

### 48. Eliminar usuario (soft delete)
DELETE {{baseUrl}}/user/delete
Authorization: Bearer {{authToken}}

### 49. Eliminar usuario permanentemente (hard delete)
# Advertencia: esto eliminará tu cuenta permanentemente
# DELETE {{baseUrl}}/user/delete?soft=false
# Authorization: Bearer {{authToken}}